import{j as e,B as g}from"./createLucideIcon.mgYnVIzO.js";import{r as i}from"./index.CG1BCU3E.js";import{D as C,a as I,P as S,b as R,c as L,d as E,e as F,I as T,f as O,g as r}from"./exportUtils.DVQzN8bT.js";import{T as U,a as $,b as w,c as y,d as z,R as k,D as A,e as B}from"./DataExportDialog.TQ3nz2F0.js";function P({onImport:o,isLoading:l=!1}){const[v,c]=i.useState(!1),[m,x]=i.useState(""),[u,f]=i.useState(""),[h,p]=i.useState(null),[j,N]=i.useState("lines"),b=async()=>{let a=[];switch(j){case"lines":a=m.split(`
`).map(s=>s.trim()).filter(s=>s.length>0);break;case"string":a=u.split(",").map(s=>s.trim()).filter(s=>s.length>0);break;case"file":if(h){const s=await h.text();h.name.endsWith(".csv")?a=s.split(`
`).slice(1).map(t=>t.split(",")[0]).map(t=>t.trim().replace(/"/g,"")).filter(t=>t.length>0):a=s.split(`
`).map(t=>t.trim()).filter(t=>t.length>0)}break}a.length>0&&(await o(a),c(!1),x(""),f(""),p(null))},D=()=>{const a=`domain
example.com
google.com
github.com`,s=new Blob([a],{type:"text/csv"}),t=window.URL.createObjectURL(s),n=document.createElement("a");n.href=t,n.download="domain-template.csv",n.click(),window.URL.revokeObjectURL(t)};return e.jsxs(C,{open:v,onOpenChange:c,children:[e.jsx(I,{asChild:!0,children:e.jsxs(g,{children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"添加域名"]})}),e.jsxs(R,{className:"sm:max-w-[600px]",children:[e.jsxs(L,{children:[e.jsx(E,{children:"导入域名"}),e.jsx(F,{children:"选择导入方式来批量添加需要监控的域名"})]}),e.jsxs(U,{value:j,onValueChange:N,className:"w-full",children:[e.jsxs($,{className:"grid w-full grid-cols-3",children:[e.jsx(w,{value:"lines",children:"按行粘贴"}),e.jsx(w,{value:"file",children:"文件导入"}),e.jsx(w,{value:"string",children:"字符串导入"})]}),e.jsx(y,{value:"lines",className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"域名列表（每行一个）"}),e.jsx(z,{placeholder:`example.com
google.com
github.com`,value:m,onChange:a=>x(a.target.value),rows:8})]})}),e.jsx(y,{value:"file",className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"上传文件"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{type:"file",accept:".csv,.txt",onChange:a=>p(a.target.files?.[0]||null)}),e.jsxs(g,{type:"button",variant:"outline",size:"sm",onClick:D,children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"下载模板"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"支持 CSV 和 TXT 格式。CSV 文件请确保域名在第一列。"})]})}),e.jsx(y,{value:"string",className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"域名字符串（逗号分隔）"}),e.jsx(T,{placeholder:"example.com, google.com, github.com",value:u,onChange:a=>f(a.target.value)})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(g,{variant:"outline",onClick:()=>c(!1),children:"取消"}),e.jsx(g,{onClick:b,disabled:l,children:l?"导入中...":"导入域名"})]})]})]})}function X(){const[o,l]=i.useState([]),[v,c]=i.useState(!1),[m,x]=i.useState(!1),[u,f]=i.useState(!0);i.useEffect(()=>{(async()=>{try{console.log("🔄 Starting to load domains...");const t=await fetch("http://localhost:3001/api/domains");if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=await t.json();console.log("✅ Domains loaded successfully:",n?.length||0),l(n)}catch(t){console.error("❌ Failed to load domains:",t),l([])}finally{console.log("🏁 Setting isInitialLoading to false"),f(!1)}})()},[]);const h=async s=>{c(!0);try{const t=await r.importDomains(s),n=await r.getDomains();return l(n),t}catch(t){return console.error("Failed to import domains:",t),{success:[],errors:[`Import failed: ${t instanceof Error?t.message:"Unknown error"}`],total:s.length}}finally{c(!1)}},p=async s=>{const t=o.find(n=>n.id===s);if(t)try{await r.toggleNotifications(s,!t.notifications),l(n=>n.map(d=>d.id===s?{...d,notifications:!d.notifications}:d))}catch(n){console.error("Failed to toggle notifications:",n)}},j=async s=>{try{await r.refreshDomain(s);const t=await r.getDomains();l(t)}catch(t){console.error("Failed to refresh domain:",t)}},N=async s=>{try{const t=await r.deleteDomains(s);t.success&&(console.log(t.message),l(n=>n.filter(d=>!s.includes(d.id))))}catch(t){throw console.error("Failed to delete domains:",t),t}},b=async()=>{try{const s=await r.getDomains();l(s)}catch(s){console.error("Failed to refresh data:",s)}},D=async()=>{x(!0);try{const s=await r.recheckAllDomains();console.log(s.message);const t=await r.getDomains();l(t)}catch(s){console.error("重新检查失败:",s)}finally{x(!1)}},a={total:o.length,normal:o.filter(s=>s.status==="normal").length,expiring:o.filter(s=>s.status==="expiring").length,expired:o.filter(s=>s.status==="expired").length,failed:o.filter(s=>s.status==="failed").length};return u?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"正在加载域名数据..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"域名列表"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["共 ",a.total," 个域名"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{onImport:h,isLoading:v}),e.jsx(A,{language:"zh"}),e.jsxs(g,{variant:"outline",onClick:D,disabled:m,className:"flex items-center gap-2",children:[e.jsx(k,{className:`h-4 w-4 ${m?"animate-spin":""}`}),"重新检查全部"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"bg-card p-4 rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:a.total}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"总域名"})]}),e.jsxs("div",{className:"bg-card p-4 rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:a.normal}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"正常"})]}),e.jsxs("div",{className:"bg-card p-4 rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:a.expiring}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"即将到期"})]}),e.jsxs("div",{className:"bg-card p-4 rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:a.expired}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"已过期"})]}),e.jsxs("div",{className:"bg-card p-4 rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:a.failed}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"查询失败"})]})]}),e.jsx("div",{children:e.jsx(B,{domains:o,onToggleNotifications:p,onRefreshDomain:j,onDeleteDomains:N,onGroupOperationSuccess:b,language:"zh"})})]})}export{X as default};
