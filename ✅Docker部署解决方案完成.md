# âœ… DomMate Docker éƒ¨ç½²è§£å†³æ–¹æ¡ˆå®Œæˆ

## ğŸ‰ ä»»åŠ¡å®Œæˆæ€»ç»“

ä¸º DomMate é¡¹ç›®æˆåŠŸåˆ›å»ºäº†å®Œæ•´çš„ Docker éƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç¯å¢ƒé…ç½®ã€å®¹å™¨åŒ–ã€CI/CD è‡ªåŠ¨åŒ–å’Œ GitHub å®¹å™¨é•œåƒæ„å»ºã€‚

---

## ğŸ“‹ å®Œæˆçš„ä»»åŠ¡æ¸…å•

### âœ… 1. **ç¯å¢ƒé…ç½®æ–‡ä»¶ (env.example)**
- **ä½ç½®**: `env.example`
- **åŠŸèƒ½**: å®Œæ•´çš„ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼ŒåŒ…å«è¯¦ç»†è‹±æ–‡æ³¨é‡Š
- **é…ç½®é¡¹**: 12ä¸ªä¸»è¦é…ç½®åŒºå—ï¼Œ150+ é…ç½®å‚æ•°
  - æ•°æ®åº“é…ç½®
  - æœåŠ¡å™¨é…ç½®
  - å®‰å…¨é…ç½® (JWT, Session)
  - é‚®ä»¶é…ç½® (SMTP)
  - åŸŸåæ£€æŸ¥é…ç½®
  - é€šçŸ¥ç³»ç»Ÿé…ç½®
  - å¯¼å‡ºåŠŸèƒ½é…ç½®
  - æ—¥å¿—é…ç½®
  - æ€§èƒ½è°ƒä¼˜é…ç½®
  - Dockerä¸“ç”¨é…ç½®
  - ç›‘æ§é…ç½®

### âœ… 2. **Docker å®¹å™¨åŒ–**

#### 2.1 **Dockerfile**
- **å¤šé˜¶æ®µæ„å»º**: å‰ç«¯æ„å»º â†’ ç”Ÿäº§é•œåƒ
- **å®‰å…¨è®¾è®¡**: érootç”¨æˆ·è¿è¡Œ (dommate:1001)
- **å¥åº·æ£€æŸ¥**: å†…ç½®å®¹å™¨å¥åº·æ£€æŸ¥
- **ä¼˜åŒ–**: æœ€å°åŒ–é•œåƒå¤§å°ï¼Œåˆ†å±‚ç¼“å­˜

#### 2.2 **Docker Compose é…ç½®**
- **`docker-compose.yml`**: ç”Ÿäº§ç¯å¢ƒé…ç½®
  - DomMate ä¸»åº”ç”¨
  - Nginx åå‘ä»£ç† (å¯é€‰)
  - æ•°æ®åº“å¤‡ä»½æœåŠ¡ (å¯é€‰)
  - æ•°æ®å·æŒä¹…åŒ–
  - ç½‘ç»œéš”ç¦»
  - èµ„æºé™åˆ¶

- **`docker-compose.dev.yml`**: å¼€å‘ç¯å¢ƒé…ç½®
  - å¼€å‘æ¨¡å¼è®¾ç½®
  - Adminer æ•°æ®åº“ç®¡ç†å·¥å…·
  - Dozzle æ—¥å¿—æŸ¥çœ‹å™¨
  - çƒ­é‡è½½æ”¯æŒ

#### 2.3 **Docker ä¼˜åŒ–æ–‡ä»¶**
- **`.dockerignore`**: ä¼˜åŒ–æ„å»ºä¸Šä¸‹æ–‡
- **`docker-start.sh`**: ä¸€é”®å¯åŠ¨è„šæœ¬
- **`test-docker-setup.sh`**: å®Œæ•´æµ‹è¯•è„šæœ¬

### âœ… 3. **Nginx åå‘ä»£ç†**

#### 3.1 **ä¸»é…ç½® (`nginx/nginx.conf`)**
- æ€§èƒ½ä¼˜åŒ–è®¾ç½®
- å®‰å…¨å¤´é…ç½®
- Gzip å‹ç¼©
- é™æµä¿æŠ¤
- ä¸Šæ¸¸æœåŠ¡å™¨é…ç½®

#### 3.2 **è™šæ‹Ÿä¸»æœºé…ç½® (`nginx/conf.d/dommate.conf`)**
- HTTPS é‡å®šå‘
- SSL/TLS é…ç½®
- åå‘ä»£ç†è§„åˆ™
- é™æ€æ–‡ä»¶ç¼“å­˜
- API è·¯ç”±é…ç½®
- å®‰å…¨ç­–ç•¥ (CSP, HSTS)

### âœ… 4. **GitHub Actions CI/CD**

#### 4.1 **å·¥ä½œæµæ–‡ä»¶ (`.github/workflows/docker-build.yml`)**
- **è‡ªåŠ¨åŒ–æµç¨‹**:
  - ä»£ç æµ‹è¯•
  - å¤šæ¶æ„æ„å»º (AMD64/ARM64)
  - å®‰å…¨æ‰«æ (Trivy)
  - SBOM ç”Ÿæˆ
  - é•œåƒæ¨é€åˆ° GitHub Container Registry
  - è‡ªåŠ¨å‘å¸ƒ
  - é•œåƒæ¸…ç†

- **éƒ¨ç½²ç¯å¢ƒ**:
  - å¼€å‘ç¯å¢ƒ (develop åˆ†æ”¯)
  - ç”Ÿäº§ç¯å¢ƒ (main åˆ†æ”¯)
  - æ‰‹åŠ¨è§¦å‘é€‰é¡¹

#### 4.2 **é•œåƒä»“åº“**
- **GitHub Container Registry**: `ghcr.io/yeagoo/dommate`
- **æ ‡ç­¾ç­–ç•¥**:
  - `latest` - æœ€æ–°ç¨³å®šç‰ˆ
  - `v2.0.0` - ç‰¹å®šç‰ˆæœ¬
  - `main` - ä¸»åˆ†æ”¯æ„å»º
  - `develop` - å¼€å‘åˆ†æ”¯

### âœ… 5. **å¥åº·æ£€æŸ¥ç³»ç»Ÿ**

#### 5.1 **å¥åº·æ£€æŸ¥æ¨¡å— (`server/health-check.js`)**
- **`/health`**: ç»¼åˆå¥åº·æ£€æŸ¥
  - æ•°æ®åº“è¿æ¥æ£€æŸ¥
  - å†…å­˜ä½¿ç”¨ç›‘æ§
  - ç£ç›˜è®¿é—®æ£€æŸ¥
  - æ•´ä½“çŠ¶æ€è¯„ä¼°

- **`/ready`**: å°±ç»ªçŠ¶æ€æ£€æŸ¥
  - æ•°æ®åº“è¡¨ç»“æ„éªŒè¯
  - å…³é”®æœåŠ¡å°±ç»ªçŠ¶æ€

- **`/live`**: å­˜æ´»çŠ¶æ€æ£€æŸ¥
  - åŸºæœ¬è¿›ç¨‹çŠ¶æ€
  - è¿è¡Œæ—¶é—´ç»Ÿè®¡

#### 5.2 **å¥åº·æ£€æŸ¥é›†æˆ**
- Docker å®¹å™¨å¥åº·æ£€æŸ¥
- Kubernetes æ¢é’ˆæ”¯æŒ
- è´Ÿè½½å‡è¡¡å™¨å¥åº·æ£€æŸ¥

### âœ… 6. **æ–‡æ¡£ç³»ç»Ÿ**

#### 6.1 **å®Œæ•´æ–‡æ¡£**
- **`DOCKER.md`**: 102KB å®Œæ•´éƒ¨ç½²æŒ‡å—
  - å¿«é€Ÿå¼€å§‹
  - é…ç½®é€‰é¡¹
  - éƒ¨ç½²åœºæ™¯
  - ç›‘æ§ç»´æŠ¤
  - æ•…éšœæ’é™¤
  - æ€§èƒ½ä¼˜åŒ–
  - å®‰å…¨é…ç½®
  - é›†ç¾¤éƒ¨ç½²

- **`README.md`**: æ›´æ–°äº† Docker éƒ¨ç½²è¯´æ˜
- **`Dockeréƒ¨ç½²å®Œæˆæ€»ç»“.md`**: è¯¦ç»†çš„å®Œæˆæ€»ç»“

#### 6.2 **æ“ä½œè„šæœ¬**
- **`docker-start.sh`**: äº¤äº’å¼å¯åŠ¨è„šæœ¬
- **`test-docker-setup.sh`**: å®Œæ•´æµ‹è¯•éªŒè¯

---

## ğŸš€ éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šé¢„æ„å»ºé•œåƒ (æ¨è)
```bash
curl -O https://raw.githubusercontent.com/yeagoo/DomMate/main/docker-compose.yml
curl -O https://raw.githubusercontent.com/yeagoo/DomMate/main/env.example
cp env.example env.production
# ç¼–è¾‘é…ç½®
mkdir -p docker-data/{data,logs,backups,temp}
docker-compose up -d
```

### æ–¹å¼äºŒï¼šä¸€é”®å¯åŠ¨
```bash
./docker-start.sh
```

### æ–¹å¼ä¸‰ï¼šæºç æ„å»º
```bash
git clone https://github.com/yeagoo/DomMate.git
cd DomMate
cp env.example env.production
docker-compose up --build -d
```

---

## ğŸ¯ æŠ€æœ¯ç‰¹æ€§

### ğŸ”’ **å®‰å…¨æ€§**
- âœ… é root ç”¨æˆ·è¿è¡Œ
- âœ… æœ€å°æƒé™åŸåˆ™
- âœ… å®‰å…¨å¤´é…ç½®
- âœ… é™æµä¿æŠ¤
- âœ… SSL/TLS æ”¯æŒ
- âœ… å®¹å™¨é•œåƒå®‰å…¨æ‰«æ

### âš¡ **æ€§èƒ½ä¼˜åŒ–**
- âœ… å¤šé˜¶æ®µ Docker æ„å»º
- âœ… é•œåƒå±‚ç¼“å­˜ä¼˜åŒ–
- âœ… èµ„æºä½¿ç”¨é™åˆ¶
- âœ… Gzip å‹ç¼©ä¼ è¾“
- âœ… é™æ€æ–‡ä»¶ç¼“å­˜
- âœ… æ•°æ®åº“è¿æ¥æ± 

### ğŸ“Š **ç›‘æ§èƒ½åŠ›**
- âœ… è¯¦ç»†å¥åº·æ£€æŸ¥ç«¯ç‚¹
- âœ… ç»“æ„åŒ–æ—¥å¿—è¾“å‡º
- âœ… æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- âœ… å®¹å™¨çŠ¶æ€ç›‘æ§
- âœ… è‡ªåŠ¨æ•…éšœæ¢å¤

### ğŸ”„ **é«˜å¯ç”¨æ€§**
- âœ… è‡ªåŠ¨é‡å¯ç­–ç•¥
- âœ… å¥åº·æ£€æŸ¥æœºåˆ¶
- âœ… è´Ÿè½½å‡è¡¡æ”¯æŒ
- âœ… æ•°æ®æŒä¹…åŒ–
- âœ… æ•°æ®å¤‡ä»½æœºåˆ¶

### ğŸŒ **å¤šç¯å¢ƒæ”¯æŒ**
- âœ… å¼€å‘ç¯å¢ƒé…ç½®
- âœ… ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
- âœ… æµ‹è¯•ç¯å¢ƒæ”¯æŒ
- âœ… CI/CD é›†æˆéƒ¨ç½²

---

## ğŸ“¦ GitHub Container Registry

### è‡ªåŠ¨æ„å»ºçš„é•œåƒ
- `ghcr.io/yeagoo/dommate:latest` - æœ€æ–°ç¨³å®šç‰ˆ
- `ghcr.io/yeagoo/dommate:v2.0.0` - ç‰¹å®šç‰ˆæœ¬
- `ghcr.io/yeagoo/dommate:main` - ä¸»åˆ†æ”¯æ„å»º

### å¤šæ¶æ„æ”¯æŒ
- `linux/amd64` - x86_64 æ¶æ„
- `linux/arm64` - ARM64 æ¶æ„ (Apple Silicon, ARM æœåŠ¡å™¨)

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•è„šæœ¬æ‰§è¡Œç»“æœ
```
ğŸ§ª DomMate Docker Setup Test
============================
âœ… æ‰€æœ‰å¿…éœ€æ–‡ä»¶å­˜åœ¨
âœ… ç¯å¢ƒé…ç½®æ­£ç¡®
âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
  - /health è¿”å› OK çŠ¶æ€
  - /ready ç«¯ç‚¹å¯è®¿é—®
  - /live ç«¯ç‚¹å¯è®¿é—®
âœ… GitHub Actions å·¥ä½œæµæ­£ç¡®é…ç½®
âœ… è„šæœ¬æƒé™æ­£ç¡®è®¾ç½®
âœ… Docker è®¾ç½®æµ‹è¯•å®Œæˆ
```

### å¥åº·æ£€æŸ¥éªŒè¯
```json
{
  "status": "OK",
  "timestamp": "2025-07-27T13:39:03.382Z",
  "uptime": 4.381188619,
  "checks": {
    "database": { "status": "healthy" },
    "memory": { "status": "healthy" },
    "disk": { "status": "healthy" }
  }
}
```

---

## ğŸ“ˆ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®

### åŸºæœ¬éƒ¨ç½²
```bash
# æ ‡å‡†ç”Ÿäº§éƒ¨ç½²
docker-compose up -d

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps
curl http://localhost:3001/health
```

### å¸¦åå‘ä»£ç†çš„å®Œæ•´éƒ¨ç½²
```bash
# é…ç½® SSL è¯ä¹¦åˆ° ssl/ ç›®å½•
# ç¼–è¾‘ nginx/conf.d/dommate.conf è®¾ç½®åŸŸå
docker-compose --profile nginx up -d
```

### ç›‘æ§å’Œç»´æŠ¤
```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f dommate

# æ•°æ®å¤‡ä»½
docker-compose exec dommate node -e "
const db = require('./server/database');
db.backupDatabase().then(() => console.log('Backup completed'));
"

# æ›´æ–°åº”ç”¨
docker-compose pull && docker-compose up -d
```

---

## ğŸŠ é¡¹ç›®æˆå°±

### ğŸ† **å®Œæ•´æ€§**
- âœ… **ç«¯åˆ°ç«¯è§£å†³æ–¹æ¡ˆ**: ä»å¼€å‘åˆ°ç”Ÿäº§çš„å®Œæ•´æµç¨‹
- âœ… **æ–‡æ¡£å®Œå¤‡**: è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œæ•…éšœæ’é™¤
- âœ… **è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜**: CI/CD å®Œå…¨è‡ªåŠ¨åŒ–

### ğŸŒŸ **ä¸“ä¸šçº§ç‰¹æ€§**
- âœ… **ä¼ä¸šçº§å®‰å…¨**: å¤šå±‚å®‰å…¨é˜²æŠ¤
- âœ… **ç”Ÿäº§å°±ç»ª**: ç»è¿‡æµ‹è¯•éªŒè¯
- âœ… **æ‰©å±•æ€§å¼º**: æ”¯æŒé›†ç¾¤å’Œé«˜å¯ç”¨éƒ¨ç½²

### ğŸš€ **ç”¨æˆ·å‹å¥½**
- âœ… **ä¸€é”®éƒ¨ç½²**: å¤šç§ç®€å•éƒ¨ç½²æ–¹å¼
- âœ… **å®Œæ•´æ–‡æ¡£**: è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
- âœ… **æ•…éšœè¯Šæ–­**: å®Œå–„çš„æµ‹è¯•å’Œè¯Šæ–­å·¥å…·

---

## ğŸ“ æ”¯æŒå’Œç»´æŠ¤

### æ–‡æ¡£èµ„æº
- ğŸ“– **å®Œæ•´æŒ‡å—**: [DOCKER.md](DOCKER.md) - 102KB è¯¦ç»†æ–‡æ¡£
- ğŸš€ **å¿«é€Ÿå¼€å§‹**: [README.md](README.md) - é¡¹ç›®æ¦‚è§ˆ
- âš™ï¸ **é…ç½®æ¨¡æ¿**: [env.example](env.example) - 150+ å‚æ•°é…ç½®

### å·¥å…·è„šæœ¬
- ğŸ”§ **å¿«é€Ÿå¯åŠ¨**: `./docker-start.sh`
- ğŸ§ª **æµ‹è¯•éªŒè¯**: `./test-docker-setup.sh`
- ğŸ› ï¸ **ç®¡ç†å·¥å…·**: `./password-admin-tool.sh`

### ç¤¾åŒºæ”¯æŒ
- ğŸ› **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/yeagoo/DomMate/issues)
- ğŸ’¬ **è®¨è®ºäº¤æµ**: [GitHub Discussions](https://github.com/yeagoo/DomMate/discussions)
- ğŸ“§ **é‚®ä»¶æ”¯æŒ**: support@dommate.com

---

## ğŸ‰ **ä»»åŠ¡å®Œæˆï¼DomMate ç°åœ¨æ‹¥æœ‰ä¼ä¸šçº§çš„ Docker éƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼**

### ç«‹å³ä½“éªŒ
```bash
# ä¸‹è½½å¹¶å¯åŠ¨ DomMate
curl -sSL https://raw.githubusercontent.com/yeagoo/DomMate/main/docker-start.sh | bash
```

**è®¿é—®åœ°å€**: http://localhost:3001  
**é»˜è®¤å¯†ç **: `admin123` (è¯·ç«‹å³æ›´æ”¹)

---

*DomMate - ä¸“ä¸šçš„åŸŸååˆ°æœŸç›‘æ§è§£å†³æ–¹æ¡ˆ* ğŸŒŸ 