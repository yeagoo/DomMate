#!/bin/bash

# GitHub æ¨é€æƒé™é—®é¢˜è§£å†³æ–¹æ¡ˆ

echo "ğŸ” ================================="
echo "ğŸš€ GitHub æ¨é€æƒé™é—®é¢˜è§£å†³æ–¹æ¡ˆ"
echo "ğŸ” ================================="

echo ""
echo "ğŸ“‹ é—®é¢˜æè¿°:"
echo "   æ¨é€åˆ° GitHub æ—¶é‡åˆ° 403 æƒé™æ‹’ç»é”™è¯¯"
echo "   è¿™æ˜¯å› ä¸ºéœ€è¦æ­£ç¡®çš„ GitHub è®¤è¯"

echo ""
echo "ğŸ’¡ è§£å†³æ–¹æ¡ˆ 1: ä½¿ç”¨ä¸ªäººè®¿é—®ä»¤ç‰Œ (æ¨è)"
echo "   1. è®¿é—® GitHub è®¾ç½®é¡µé¢:"
echo "      https://github.com/settings/tokens"
echo ""
echo "   2. ç‚¹å‡» 'Generate new token (classic)'"
echo ""
echo "   3. é…ç½®ä»¤ç‰Œ:"
echo "      - Note: 'DomMate Docker GHCR Push'"
echo "      - Expiration: 90 days (æˆ–æ ¹æ®éœ€è¦)"
echo "      - å‹¾é€‰æƒé™:"
echo "        â˜‘ï¸ repo (å®Œæ•´ä»“åº“è®¿é—®)"
echo "        â˜‘ï¸ write:packages (å†™å…¥åŒ…)"
echo "        â˜‘ï¸ read:packages (è¯»å–åŒ…)"
echo "        â˜‘ï¸ delete:packages (åˆ é™¤åŒ…)"
echo ""
echo "   4. ç”Ÿæˆå¹¶å¤åˆ¶ä»¤ç‰Œ"
echo ""
echo "   5. è®¾ç½® Git å‡­æ®:"
echo "      git config --global credential.helper store"
echo "      git push origin main"
echo "      # å½“æç¤ºæ—¶ï¼Œè¾“å…¥:"
echo "      # Username: yeagoo"
echo "      # Password: <ä½ çš„ä¸ªäººè®¿é—®ä»¤ç‰Œ>"

echo ""
echo "ğŸ’¡ è§£å†³æ–¹æ¡ˆ 2: ä½¿ç”¨ SSH å¯†é’¥"
echo "   1. ç”Ÿæˆ SSH å¯†é’¥:"
echo "      ssh-keygen -t ed25519 -C 'i90h@vip.qq.com'"
echo ""
echo "   2. æ·»åŠ åˆ° SSH ä»£ç†:"
echo "      eval \"\$(ssh-agent -s)\""
echo "      ssh-add ~/.ssh/id_ed25519"
echo ""
echo "   3. å¤åˆ¶å…¬é’¥åˆ° GitHub:"
echo "      cat ~/.ssh/id_ed25519.pub"
echo "      # åœ¨ GitHub Settings > SSH Keys ä¸­æ·»åŠ "
echo ""
echo "   4. æ›´æ”¹è¿œç¨‹ URL:"
echo "      git remote set-url origin git@github.com:yeagoo/DomMate.git"
echo "      git push origin main"

echo ""
echo "ğŸ’¡ è§£å†³æ–¹æ¡ˆ 3: å®‰è£… GitHub CLI"
echo "   1. å®‰è£…:"
echo "      # Ubuntu/Debian:"
echo "      curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg"
echo "      echo \"deb [arch=\$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main\" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null"
echo "      sudo apt update && sudo apt install gh"
echo ""
echo "   2. è®¤è¯:"
echo "      gh auth login"
echo "      # é€‰æ‹© GitHub.com, HTTPS, ä½¿ç”¨æµè§ˆå™¨è®¤è¯"
echo ""
echo "   3. æ¨é€:"
echo "      git push origin main"

echo ""
echo "ğŸ¯ å¿«é€Ÿå¼€å§‹ (æ¨èæ–¹æ¡ˆ1):"
echo "   1. è®¿é—®: https://github.com/settings/tokens"
echo "   2. åˆ›å»ºä»¤ç‰Œï¼Œå‹¾é€‰ repo å’Œ write:packages æƒé™"
echo "   3. è¿è¡Œä»¥ä¸‹å‘½ä»¤:"
echo ""
echo "      git config --global credential.helper store"
echo "      git push origin main"
echo ""
echo "   4. è¾“å…¥ GitHub ç”¨æˆ·åå’Œä»¤ç‰Œä½œä¸ºå¯†ç "

echo ""
echo "ğŸ“š å®Œæˆåå°†è§¦å‘:"
echo "   âœ… GitHub Actions è‡ªåŠ¨æ„å»º"
echo "   âœ… Docker é•œåƒæ¨é€åˆ° GHCR"
echo "   âœ… å¤šæ¶æ„æ”¯æŒ (AMD64 + ARM64)"
echo "   âœ… è‡ªåŠ¨ç‰ˆæœ¬æ ‡è®°"

echo ""
echo "ğŸŒ æ„å»ºå®Œæˆåå¯è®¿é—®:"
echo "   ğŸ“¦ GHCR: https://github.com/yeagoo/DomMate/pkgs/container/dommate"
echo "   ğŸ”„ Actions: https://github.com/yeagoo/DomMate/actions"

echo ""
echo "ğŸš€ ä½¿ç”¨ GHCR é•œåƒè¿è¡Œ:"
echo "      docker run -d --name dommate-ghcr \\"
echo "        -p 3003:3001 \\"
echo "        -v \$(pwd)/docker-data:/app/data \\"
echo "        ghcr.io/yeagoo/dommate:latest" 