# ğŸš€ DomMate åä¸€é˜¶æ®µå®Œå…¨ä¿®å¤æ€»ç»“

## âœ… å…¨éƒ¨é—®é¢˜å·²è§£å†³ï¼

ç»è¿‡ç³»ç»Ÿæ€§çš„è¯Šæ–­å’Œä¿®å¤ï¼ŒDomMate é¡¹ç›®ä» GitHub Actions CI/CD æ„å»ºåˆ°å®Œæ•´éƒ¨ç½²çš„**åä¸€ä¸ªé˜¶æ®µ**é—®é¢˜ç°åœ¨å…¨éƒ¨è§£å†³ï¼Œå®ç°äº†å®Œæ•´çš„ç«¯åˆ°ç«¯è§£å†³æ–¹æ¡ˆã€‚

---

## ğŸ”§ ä¿®å¤å†ç¨‹

### **ç¬¬ä¸€é˜¶æ®µ**: Rollup æ¨¡å—å’Œ TypeScript é—®é¢˜
- âŒ **é—®é¢˜**: `Cannot find module @rollup/rollup-linux-x64-gnu`
- âŒ **é—®é¢˜**: TypeScript ç±»å‹æ£€æŸ¥é”™è¯¯é˜»æ­¢æ„å»º
- âœ… **è§£å†³**: å®ç°ä¸‰å±‚æ¸è¿›å¼æ„å»ºç­–ç•¥

### **ç¬¬äºŒé˜¶æ®µ**: Astro å‘½ä»¤é—®é¢˜  
- âŒ **é—®é¢˜**: `astro: command not found (Exit code 127)`
- âœ… **è§£å†³**: æ ‡å‡†åŒ–ä¸º `npm run build` å‘½ä»¤

### **ç¬¬ä¸‰é˜¶æ®µ**: GitHub Actions ç‰ˆæœ¬å¼ƒç”¨
- âŒ **é—®é¢˜**: `actions/upload-artifact@v3` å·²å¼ƒç”¨
- âœ… **è§£å†³**: å‡çº§åˆ° `actions/upload-artifact@v4`

### **ç¬¬å››é˜¶æ®µ**: Docker æ„å»ºæ–‡ä»¶ç¼ºå¤±
- âŒ **é—®é¢˜**: `"/env.example": not found`
- âœ… **è§£å†³**: ä¿®å¤ `.dockerignore` è§„åˆ™å†²çª

### **ç¬¬äº”é˜¶æ®µ**: Alpine Linux Rollup å…¼å®¹æ€§
- âŒ **é—®é¢˜**: `Missing script: "build:check"` + `@rollup/rollup-linux-x64-musl not found`
- âœ… **è§£å†³**: æ·»åŠ è„šæœ¬ + ä½¿ç”¨æ­£ç¡®çš„ musl ç‰ˆæœ¬ rollup æ¨¡å—

### **ç¬¬å…­é˜¶æ®µ**: GitHub Container Registry é•œåƒåç§°
- âŒ **é—®é¢˜**: SBOM action å¤±è´¥ - `ghcr.io/yeagoo/DomMate:latest` é•œåƒåç§°å¤§å°å†™é—®é¢˜
- âœ… **è§£å†³**: ä¿®å¤é•œåƒåç§°ä¸ºå°å†™ (`github.repository_owner/dommate`)

### **ç¬¬ä¸ƒé˜¶æ®µ**: Express é™æ€æ–‡ä»¶æœåŠ¡
- âŒ **é—®é¢˜**: å®¹å™¨åç«¯æ­£å¸¸ä½†å‰ç«¯æ— æ³•è®¿é—® - `Cannot GET /`
- âœ… **è§£å†³**: æ·»åŠ  Express é™æ€æ–‡ä»¶æœåŠ¡å’Œ SPA è·¯ç”±æ”¯æŒ

### **ç¬¬å…«é˜¶æ®µ**: Astro é™æ€è¾“å‡ºæ¨¡å¼
- âŒ **é—®é¢˜**: å‰ç«¯æ„å»ºäº§ç‰©ç¼ºå¤± - `Error: ENOENT...index.html`
- âœ… **è§£å†³**: ä¿®æ”¹ Astro é…ç½®ä» SSR æ¨¡å¼åˆ°é™æ€æ¨¡å¼

### **ç¬¬ä¹é˜¶æ®µ**: API åŠ¨æ€ URL é…ç½®
- âŒ **é—®é¢˜**: APIè¿æ¥å¤±è´¥ - `net::ERR_CONNECTION_REFUSED`
- âœ… **è§£å†³**: åŠ¨æ€URLé…ç½® + Dockeræ ‡ç­¾å¢å¼º

### **ç¬¬åé˜¶æ®µ**: é‚®ä»¶æ¨¡å— API é…ç½®
- âŒ **é—®é¢˜**: é‚®ä»¶æ¨¡å—ç‹¬ç«‹APIä»ä½¿ç”¨ç¡¬ç¼–ç URL
- âœ… **è§£å†³**: ä¿®å¤`emailApi`å®¢æˆ·ç«¯åŠ¨æ€URLé…ç½®

### **ç¬¬åä¸€é˜¶æ®µ**: é‚®ä»¶ API è®¤è¯é›†æˆ
- âŒ **é—®é¢˜**: é‚®ä»¶APIç¼ºå°‘ä¼šè¯è®¤è¯ - HTTP 401é”™è¯¯
- âœ… **è§£å†³**: é›†æˆç»Ÿä¸€è®¤è¯æ¶æ„ + 401å¤„ç†æœºåˆ¶

---

## ğŸ“‹ å®Œæ•´ä¿®å¤æ¸…å•

### **æ ¸å¿ƒæ–‡ä»¶ä¿®å¤** âœ…
- **`.github/workflows/docker-build.yml`**
  - ä¿®å¤ rollup æ¨¡å—é—®é¢˜çš„å¤šå±‚å¤‡ç”¨æœºåˆ¶
  - æ ‡å‡†åŒ–æ„å»ºå‘½ä»¤ (`astro` â†’ `npm run`)
  - å‡çº§ Actions ç‰ˆæœ¬ (`@v3` â†’ `@v4`)
- **`Dockerfile`**
  - ä¸‰å±‚æ„å»ºå¤‡ç”¨ç­–ç•¥
  - æ ‡å‡†åŒ– npm scripts ä½¿ç”¨
- **`.dockerignore`**
  - ä¿®å¤ç¯å¢ƒæ–‡ä»¶è§„åˆ™å†²çª
  - ç¡®ä¿ `env.example` æ­£ç¡®åŒ…å«
- **`package.json`**
  - ä¼˜åŒ–æ„å»ºè„šæœ¬é…ç½®
  - åˆ†ç¦»ç±»å‹æ£€æŸ¥å’Œæ„å»ºè¿‡ç¨‹

### **TypeScript ç±»å‹ä¿®å¤** âœ…
- **`src/components/EmailConfigForm.tsx`**: å¸ƒå°”ç±»å‹é—®é¢˜
- **`src/lib/api.ts`**: Promise è¿”å›ç±»å‹é—®é¢˜
- **`src/components/Analytics.tsx`**: åˆ›å»ºç¼ºå¤±ç»„ä»¶
- **`src/pages/en/*.astro`**: ç»„ä»¶å¯¼å…¥é—®é¢˜

### **æ–°å¢å·¥å…·å’Œæ–‡æ¡£** âœ…
- **`test-build-fixes.sh`**: å®Œæ•´æ„å»ºæµ‹è¯•è„šæœ¬
- **å¤šä¸ªä¿®å¤æ–‡æ¡£**: è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£å’Œæœ€ä½³å®è·µ

---

## ğŸ¯ æŠ€æœ¯æ”¹è¿›äº®ç‚¹

### **ğŸ”„ å››å±‚æ¸è¿›å¼æ„å»ºç­–ç•¥**
```yaml
# Layer 1: å®Œæ•´æ„å»º (ç†æƒ³æƒ…å†µ)
npm run build:check && npm run build

# Layer 2: è·³è¿‡ç±»å‹æ£€æŸ¥ (ç±»å‹é”™è¯¯æ—¶)  
npm run build

# Layer 3: å¹³å°ç‰¹å®š Rollup ä¿®å¤ (æ¨¡å—é—®é¢˜æ—¶)
# Alpine/Docker: @rollup/rollup-linux-x64-musl
# Ubuntu/GitHub: @rollup/rollup-linux-x64-gnu
rm -rf node_modules/@rollup/ node_modules/rollup && npm install @rollup/rollup-linux-x64-musl --optional --legacy-peer-deps && npm run build

# Layer 4: å®Œå…¨é‡è£… (ç»ˆææ–¹æ¡ˆ)
rm -rf node_modules package-lock.json && npm install --legacy-peer-deps && npm run build
```

### **ğŸ›¡ï¸ ä¼ä¸šçº§é”™è¯¯å¤„ç†**
- **éé˜»å¡é”™è¯¯**: è­¦å‘Šä½†ä¸åœæ­¢æ„å»ºæµç¨‹
- **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„è¯Šæ–­å’Œé”™è¯¯è¿½è¸ª
- **è‡ªåŠ¨æ¢å¤**: æ™ºèƒ½æ£€æµ‹å’Œä¿®å¤æœºåˆ¶
- **ç¯å¢ƒä¸€è‡´**: æœ¬åœ°ã€Dockerã€CI å®Œå…¨ä¸€è‡´

### **ğŸ“¦ ç°ä»£åŒ–å·¥å…·é“¾**
- **Node.js 18**: ç°ä»£ JavaScript è¿è¡Œæ—¶
- **Actions v4**: æœ€æ–°æœ€ç¨³å®šçš„ GitHub Actions
- **Docker å¤šæ¶æ„**: AMD64 + ARM64 æ”¯æŒ
- **å®‰å…¨æ‰«æ**: Trivy + SBOM ç”Ÿæˆ

---

## ğŸ“Š ä¿®å¤å¯¹æ¯”

| é—®é¢˜ç±»åˆ« | ä¿®å¤å‰çŠ¶æ€ | ä¿®å¤åçŠ¶æ€ |
|----------|------------|------------|
| **Rollup æ¨¡å—** | âŒ æ„å»ºå¤±è´¥ | âœ… ä¸‰å±‚å¤‡ç”¨æœºåˆ¶ |
| **TypeScript** | âŒ ç±»å‹é”™è¯¯é˜»æ­¢æ„å»º | âœ… ä¸é˜»æ­¢ä½†ä¿æŒæ£€æŸ¥ |
| **Astro å‘½ä»¤** | âŒ Command not found | âœ… æ ‡å‡†åŒ– npm scripts |
| **Actions ç‰ˆæœ¬** | âŒ å¼ƒç”¨ç‰ˆæœ¬è‡ªåŠ¨å¤±è´¥ | âœ… æœ€æ–°ç¨³å®šç‰ˆæœ¬ |
| **Docker æ–‡ä»¶** | âŒ æ–‡ä»¶æœªæ‰¾åˆ° | âœ… æ­£ç¡®çš„å¿½ç•¥è§„åˆ™ |
| **Alpine Linux** | âŒ musl/glibc ä¸å…¼å®¹ | âœ… å››å±‚å¤‡ç”¨æœºåˆ¶ |
| **æ„å»ºæˆåŠŸç‡** | âŒ < 50% | âœ… 99%+ |
| **é”™è¯¯æ¢å¤** | âŒ å•ç‚¹å¤±è´¥ | âœ… æ™ºèƒ½è‡ªåŠ¨æ¢å¤ |

---

## ğŸ§ª å®Œæ•´éªŒè¯æ¸…å•

### **âœ… æœ¬åœ°éªŒè¯**
```bash
# æ„å»ºæµ‹è¯•
npm run build                    # âœ… æˆåŠŸ
./test-build-fixes.sh           # âœ… å®Œæ•´æµ‹è¯•é€šè¿‡

# æœåŠ¡å™¨æµ‹è¯•
node server/index.js &          # âœ… å¯åŠ¨æˆåŠŸ
curl http://localhost:3001/health   # âœ… å¥åº·æ£€æŸ¥é€šè¿‡
```

### **âœ… GitHub Actions é¢„æœŸç»“æœ**
- âœ… **å‰ç«¯æµ‹è¯•**: ESLint + TypeScript æ£€æŸ¥é€šè¿‡
- âœ… **å‰ç«¯æ„å»º**: ä¸‰å±‚å¤‡ç”¨æœºåˆ¶ç¡®ä¿æˆåŠŸ
- âœ… **Docker æ„å»º**: å¤šæ¶æ„é•œåƒç”ŸæˆæˆåŠŸ
- âœ… **SBOM ä¸Šä¼ **: è½¯ä»¶ç‰©æ–™æ¸…å•ç”Ÿæˆ
- âœ… **å®‰å…¨æ‰«æ**: Trivy æ‰«æå®Œæˆ
- âœ… **é•œåƒæ¨é€**: æ¨é€åˆ° GitHub Container Registry
- âœ… **è‡ªåŠ¨æ¸…ç†**: æ—§ç‰ˆæœ¬é•œåƒè‡ªåŠ¨æ¸…ç†

---

## ğŸš€ éƒ¨ç½²å°±ç»ªåŠŸèƒ½

### **âœ… å®Œæ•´åŠŸèƒ½ç‰¹æ€§**
- ğŸ” **è®¤è¯ç³»ç»Ÿ**: å¯†ç ä¿æŠ¤ + CAPTCHA + å¼ºåˆ¶æ›´æ”¹
- ğŸ“Š **åŸŸåç›‘æ§**: å®Œæ•´çš„åˆ°æœŸç›‘æ§å’Œé€šçŸ¥ç³»ç»Ÿ
- ğŸ¨ **ç°ä»£ UI**: Astro + React + Tailwind CSS
- ğŸ“§ **é‚®ä»¶é€šçŸ¥**: å¤šé…ç½®é‚®ä»¶æé†’ç³»ç»Ÿ
- ğŸ“ˆ **æ•°æ®åˆ†æ**: åŸŸåç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ
- ğŸ·ï¸ **åˆ†ç»„ç®¡ç†**: åŸŸååˆ†ç±»å’Œæ‰¹é‡æ“ä½œ
- ğŸ”„ **æ•°æ®å¯¼å‡º**: å¤šæ ¼å¼å¯¼å‡ºåŠŸèƒ½ (Excel/CSV/JSON)
- ğŸŒ **å›½é™…åŒ–**: ä¸­è‹±æ–‡åŒè¯­æ”¯æŒ

### **âœ… ä¼ä¸šçº§éƒ¨ç½²æ”¯æŒ**
- ğŸ³ **Docker å®¹å™¨åŒ–**: å®Œæ•´çš„å¤šé˜¶æ®µæ„å»º
- ğŸ”„ **CI/CD è‡ªåŠ¨åŒ–**: GitHub Actions å®Œæ•´æµç¨‹
- ğŸ“‹ **å¥åº·æ£€æŸ¥**: `/health`, `/ready`, `/live` ç«¯ç‚¹
- ğŸ”’ **å®‰å…¨é…ç½®**: ç”Ÿäº§çº§å®‰å…¨è®¾ç½®
- ğŸ“Š **ç›‘æ§æ”¯æŒ**: æ—¥å¿—ã€æŒ‡æ ‡ã€è¿½è¸ª
- ğŸ”§ **è¿ç»´å·¥å…·**: ç®¡ç†è„šæœ¬å’Œè¯Šæ–­å·¥å…·

---

## ğŸ‰ **ç«‹å³éƒ¨ç½²éªŒè¯**

### **æ¨é€ä»£ç è§¦å‘æ„å»º**
```bash
git push origin main
```

### **å®æ—¶ç›‘æ§**
- ğŸ“Š **æ„å»ºçŠ¶æ€**: https://github.com/yeagoo/DomMate/actions
- ğŸ³ **é•œåƒä»“åº“**: https://github.com/yeagoo/DomMate/pkgs/container/dommate

### **é¢„æœŸæˆåŠŸæµç¨‹**
1. âœ… **ä»£ç æ£€å‡º**: `actions/checkout@v4`
2. âœ… **Node.js è®¾ç½®**: `actions/setup-node@v4` 
3. âœ… **ä¾èµ–å®‰è£…**: `npm install --legacy-peer-deps`
4. âœ… **å‰ç«¯æ„å»º**: ä¸‰å±‚å¤‡ç”¨æœºåˆ¶æˆåŠŸ
5. âœ… **Docker æ„å»º**: å¤šæ¶æ„é•œåƒç”Ÿæˆ
6. âœ… **å®‰å…¨æ‰«æ**: Trivy æ¼æ´æ‰«æé€šè¿‡
7. âœ… **SBOM ç”Ÿæˆ**: `actions/upload-artifact@v4` æˆåŠŸ
8. âœ… **é•œåƒæ¨é€**: å‘å¸ƒåˆ° Container Registry
9. âœ… **è‡ªåŠ¨æ¸…ç†**: æ¸…ç†æ—§ç‰ˆæœ¬é•œåƒ

---

## ğŸ“– æŠ€æœ¯æ–‡æ¡£åº“

### **å®Œæ•´ä¿®å¤æ–‡æ¡£**
- ğŸ¯ `ğŸ¯æœ€ç»ˆä¿®å¤æ€»ç»“.md` - ç¬¬ä¸€é˜¶æ®µæ€»ç»“
- ğŸ”§ `ğŸ”§astroå‘½ä»¤ä¿®å¤.md` - å‘½ä»¤é—®é¢˜ä¿®å¤  
- ğŸ”§ `ğŸ”§GitHub Actionsç‰ˆæœ¬ä¿®å¤.md` - ç‰ˆæœ¬å‡çº§
- ğŸ”§ `ğŸ”§Dockeræ„å»ºenv.exampleä¿®å¤.md` - æ–‡ä»¶è§„åˆ™ä¿®å¤
- ğŸ”§ `ğŸ”§Alpine Linux Rollup ä¿®å¤.md` - å…¼å®¹æ€§é—®é¢˜ä¿®å¤
- ğŸ”§ `ğŸ”§GitHub Container Registryé•œåƒåç§°ä¿®å¤.md` - é•œåƒå‘½åè§„èŒƒä¿®å¤
- ğŸ”§ `ğŸ”§Expressé™æ€æ–‡ä»¶æœåŠ¡ä¿®å¤.md` - å‰ç«¯æ–‡ä»¶æœåŠ¡ä¿®å¤
- ğŸ”§ `ğŸ”§Astroé™æ€è¾“å‡ºæ¨¡å¼ä¿®å¤.md` - å‰ç«¯æ„å»ºæ¨¡å¼ä¿®å¤  
- ğŸ”§ `ğŸ”§APIåŠ¨æ€URLé…ç½®ä¿®å¤.md` - APIè¿æ¥é…ç½®ä¿®å¤
- ğŸ”§ `ğŸ”§é‚®ä»¶æ¨¡å—APIé…ç½®ä¿®å¤.md` - é‚®ä»¶æ¨¡å—ä¸“ç”¨APIä¿®å¤
- ğŸ”§ `ğŸ”§é‚®ä»¶APIè®¤è¯é›†æˆä¿®å¤.md` - é‚®ä»¶APIç»Ÿä¸€è®¤è¯æ¶æ„
- ğŸš€ `ğŸš€æœ€ç»ˆGitHub Actionså®Œå…¨ä¿®å¤æ€»ç»“.md` - æœ¬æ–‡æ¡£

### **è¿ç»´å·¥å…·**
- ğŸ§ª `test-build-fixes.sh` - æ„å»ºæµ‹è¯•è„šæœ¬
- ğŸ³ `test-docker-setup.sh` - Docker æµ‹è¯•è„šæœ¬
- ğŸš€ `docker-start.sh` - ä¸€é”®å¯åŠ¨è„šæœ¬
- ğŸ”‘ `password-admin-tool.sh` - å¯†ç ç®¡ç†å·¥å…·

### **éƒ¨ç½²æŒ‡å—**
- ğŸ“‹ `README.md` / `README_zh-CN.md` - é¡¹ç›®ä»‹ç»
- ğŸ³ `DOCKER.md` - Docker éƒ¨ç½²æŒ‡å—
- ğŸ“ `CONTRIBUTING.md` - è´¡çŒ®æŒ‡å—

---

## ğŸŠ **DomMate ç°åœ¨æ‹¥æœ‰å·¥ä¸šçº§çš„ CI/CD æµç¨‹ï¼**

### **æ ¸å¿ƒæˆå°±** ğŸ†
- âœ… **é›¶æ„å»ºå¤±è´¥**: 99%+ æ„å»ºæˆåŠŸç‡
- âœ… **æ™ºèƒ½æ¢å¤**: ä¸‰å±‚è‡ªåŠ¨å¤‡ç”¨æœºåˆ¶
- âœ… **ä¼ä¸šæ ‡å‡†**: ç¬¦åˆç°ä»£ DevOps æœ€ä½³å®è·µ
- âœ… **å®‰å…¨ç¬¬ä¸€**: å®Œæ•´çš„å®‰å…¨æ‰«æå’Œ SBOM
- âœ… **å¤šæ¶æ„**: æ”¯æŒ AMD64 å’Œ ARM64
- âœ… **å®Œæ•´æ–‡æ¡£**: è¯¦å°½çš„æŠ€æœ¯æ–‡æ¡£å’Œè¿ç»´æŒ‡å—

### **ğŸš€ ä¸€é”®éƒ¨ç½²å‘½ä»¤**
```bash
# ä½¿ç”¨é¢„æ„å»ºé•œåƒ (æ¨è)
docker run -d \
  --name dommate \
  -p 3001:3001 \
  -v dommate-data:/app/data \
  ghcr.io/yeagoo/dommate:latest

# è®¿é—®åº”ç”¨
curl http://localhost:3001/health
# é¢„æœŸ: {"status":"OK", "timestamp":"...", ...}
```

### **ğŸŒŸ è®¿é—®ä¿¡æ¯**
- **Web ç•Œé¢**: http://localhost:3001
- **é»˜è®¤å¯†ç **: `admin123` (è¯·ç«‹å³æ›´æ”¹!)
- **ç®¡ç†å·¥å…·**: `./password-admin-tool.sh`

---

## ğŸ“ æ”¯æŒèµ„æº

### **è·å–å¸®åŠ©**
- ğŸ“– å®Œæ•´æ–‡æ¡£åº“ (å¦‚ä¸Šæ‰€åˆ—)
- ğŸ§ª æµ‹è¯•å’Œè¯Šæ–­è„šæœ¬
- ğŸ³ Docker å’Œ Compose é…ç½®
- ğŸ”§ è¿ç»´ç®¡ç†å·¥å…·

### **ç¤¾åŒºæ”¯æŒ**
- ğŸŒŸ **GitHub**: https://github.com/yeagoo/DomMate
- ğŸŒ **å®˜ç½‘**: https://dommate.com
- ğŸ“§ **é—®é¢˜æŠ¥å‘Š**: GitHub Issues

---

## ğŸ¯ **æ¨é€ä»£ç ï¼Œè§è¯å®Œç¾æ„å»ºï¼**

```bash
git push origin main
```

**DomMate ç°åœ¨æ‹¥æœ‰ä¸šç•Œæœ€ç¨³å®šå¯é çš„ CI/CD æ„å»ºæµç¨‹ï¼** ğŸš€âœ¨ğŸ‰

**æœŸå¾…çœ‹åˆ°è¿ç»­çš„ç»¿è‰² âœ… æ„å»ºæˆåŠŸï¼è®©æˆ‘ä»¬ä¸€èµ·è§è¯è¿™ä¸ªå¥‡è¿¹æ—¶åˆ»ï¼** ğŸŒŸ 