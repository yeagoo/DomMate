# 📧 邮件通知系统 - 用户使用指南

## 🌟 系统概览

DomainFlow邮件通知系统是一个完整的域名监控邮件解决方案，支持：
- 🔧 SMTP服务器配置管理
- 📝 可视化邮件模板编辑
- 🔔 智能通知规则设置
- 📊 发送状态监控和日志

## 🚀 快速开始

### 系统访问
- **前端管理界面**: http://localhost:4322/email
- **系统要求**: 现代浏览器（Chrome, Firefox, Safari, Edge）

### 首次使用流程
1. **配置SMTP服务器** → 2. **创建或编辑邮件模板** → 3. **设置通知规则** → 4. **测试发送**

## 📧 SMTP配置管理

### 添加邮件配置

1. 访问邮件系统首页，点击 **"管理配置"**
2. 点击 **"添加配置"** 按钮
3. 填写以下信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| **配置名称** | 便于识别的名称 | `Gmail SMTP` |
| **SMTP服务器** | 邮件服务器地址 | `smtp.gmail.com` |
| **端口** | 服务器端口 | `587` (STARTTLS) 或 `465` (SSL) |
| **使用SSL/TLS** | 安全连接开关 | 端口465需开启，587可选 |
| **用户名** | 登录邮箱地址 | `your-email@gmail.com` |
| **密码** | 邮箱密码或专用密码 | `your-password` |
| **发件人邮箱** | 邮件发送地址 | `noreply@yourdomain.com` |
| **发件人名称** | 显示的发件人名称 | `域名监控系统` |
| **设为默认** | 是否设为默认配置 | 建议首个配置设为默认 |

4. 点击 **"测试连接"** 验证配置
5. 测试成功后，点击 **"保存配置"**

### 常用SMTP配置示例

#### Gmail配置
```
服务器: smtp.gmail.com
端口: 587
SSL/TLS: 启用
用户名: your-email@gmail.com
密码: 应用专用密码（不是Gmail密码）
```

#### QQ邮箱配置
```
服务器: smtp.qq.com  
端口: 587
SSL/TLS: 启用
用户名: your-qq@qq.com
密码: 授权码（不是QQ密码）
```

#### 企业邮箱配置
```
服务器: smtp.exmail.qq.com
端口: 587
SSL/TLS: 启用  
用户名: your-email@company.com
密码: 邮箱密码
```

### 配置管理操作

- **编辑配置**: 点击配置卡片右侧的编辑按钮 ✏️
- **删除配置**: 点击删除按钮 🗑️（需要确认）
- **测试配置**: 在编辑时随时可以测试连接

## 📝 邮件模板管理

### 系统预置模板

系统预装了3个专业模板：
1. **7天到期提醒（中文）** - 适用于中文用户的到期通知
2. **7天到期提醒（英文）** - 适用于英文用户的到期通知  
3. **30天到期提醒（英文）** - 提前30天的到期预警

### 创建自定义模板

1. 点击 **"管理模板"** → **"添加模板"**
2. 配置模板基本信息：

| 字段 | 说明 |
|------|------|
| **模板名称** | 如：`每日域名汇总报告` |
| **模板类型** | `到期提醒` 或 `汇总报告` |
| **模板语言** | `中文` 或 `英文` |

3. 编写模板内容：

#### 邮件主题
使用变量动态生成主题：
```handlebars
域名 {{domain}} 将在 {{days}} 天后到期
```

#### 邮件内容
使用Handlebars语法编写HTML内容：
```html
<div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
    <h2 style="color: #e74c3c;">域名到期提醒</h2>
    <p>您好，</p>
    <p>您的域名 <strong>{{domain}}</strong> 将在 <strong style="color: #e74c3c;">{{days}} 天</strong>后到期。</p>
    <p>到期日期: <strong>{{expiryDate}}</strong></p>
    
    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0;">
        <h3>域名详情</h3>
        <ul>
            <li>当前状态: {{status}}</li>
            <li>注册商: {{registrar}}</li>
            <li>DNS服务器: 
                {{#each nameservers}}
                    <br>&nbsp;&nbsp;- {{this}}
                {{/each}}
            </li>
        </ul>
    </div>
    
    <p style="color: #666; font-size: 12px;">此邮件由域名监控系统自动发送</p>
</div>
```

### 可用变量

#### 到期提醒模板变量
- `{{domain}}` - 域名
- `{{days}}` - 剩余天数  
- `{{expiryDate}}` - 到期日期
- `{{status}}` - 域名状态
- `{{registrar}}` - 注册商
- `{{nameservers}}` - DNS服务器列表

#### 汇总报告模板变量
- `{{totalDomains}}` - 总域名数
- `{{expiringSoon}}` - 即将到期数量
- `{{expired}}` - 已过期数量
- `{{active}}` - 活跃域名数
- `{{date}}` - 报告日期
- `{{domains}}` - 域名列表

### 模板预览

编辑模板时，点击 **"预览模板"** 可以：
- 查看模板渲染效果
- 验证变量替换
- 检查HTML样式
- 确认邮件格式

## 🔔 通知规则配置

### 创建通知规则

1. 点击 **"管理规则"** → **"添加规则"**
2. 配置规则参数：

| 字段 | 说明 | 选项 |
|------|------|------|
| **规则名称** | 规则描述 | 如：`7天到期提醒规则` |
| **通知类型** | 通知触发条件 | `域名到期提醒`、`每日汇总报告`、`每周汇总报告` |
| **提前天数** | 到期前多少天提醒 | 仅到期提醒需要，如：7、30、90 |
| **邮件配置** | 使用的SMTP配置 | 从已创建的配置中选择 |
| **邮件模板** | 使用的邮件模板 | 根据类型自动过滤 |
| **收件人** | 接收邮件的地址 | 可添加多个，支持删除 |
| **启用规则** | 是否激活此规则 | 开启后规则生效 |

### 通知类型说明

#### 域名到期提醒
- **触发条件**: 域名将在指定天数内到期
- **发送频率**: 每天检查一次，符合条件就发送
- **推荐配置**: 7天、30天、90天提前提醒

#### 每日汇总报告  
- **触发条件**: 每天定时发送
- **发送时间**: 每天早上8点
- **内容**: 域名状态统计、即将到期列表

#### 每周汇总报告
- **触发条件**: 每周定时发送  
- **发送时间**: 每周一早上8点
- **内容**: 周度域名状态汇总

### 收件人管理

- **添加收件人**: 点击 "添加收件人" 按钮
- **删除收件人**: 点击收件人输入框右侧的删除按钮
- **邮箱验证**: 系统会验证邮箱格式
- **批量管理**: 支持多个收件人同时接收

## 📊 日志监控

### 查看发送日志

1. 点击 **"查看日志"** 查看所有邮件发送记录
2. 日志信息包括：
   - 发送时间
   - 收件人
   - 邮件主题  
   - 发送状态（成功/失败）
   - 错误信息（如果有）
   - 重试次数

### 日志状态说明

| 状态 | 说明 | 操作 |
|------|------|------|
| 🟢 **已发送** | 邮件发送成功 | 无需操作 |
| 🟡 **待发送** | 等待发送队列处理 | 等待系统处理 |
| 🔄 **重试中** | 发送失败，正在重试 | 检查SMTP配置 |
| 🔴 **发送失败** | 多次重试后仍失败 | 检查配置和网络 |

## ⚙️ 系统设置和维护

### 定时任务

系统自动运行以下定时任务：
- **每15分钟**: 处理待发送邮件队列
- **每天8:00**: 检查到期提醒，发送日报
- **每周一8:00**: 发送周报
- **每天2:00**: 清理过期日志

### 系统监控

在系统首页可以查看：
- 📊 **统计概览**: 配置数、模板数、规则数
- 📈 **今日发送**: 成功发送数、失败数
- 🎯 **系统状态**: 各组件运行状态

### 故障排查

#### SMTP连接失败
1. 检查服务器地址和端口
2. 验证用户名和密码
3. 确认SSL/TLS设置
4. 检查网络连接

#### 邮件发送失败
1. 查看日志中的错误信息
2. 验证收件人邮箱地址
3. 检查邮件内容是否过大
4. 确认SMTP配置有效性

#### 模板渲染错误
1. 检查Handlebars语法
2. 验证变量名称正确性
3. 确认数据源完整性

## 🎯 最佳实践

### SMTP配置建议
- **使用专用密码**: Gmail、QQ等邮箱使用应用专用密码
- **配置备份**: 创建多个SMTP配置防止单点故障
- **定期测试**: 定期测试连接确保配置有效

### 模板设计原则
- **简洁明了**: 邮件内容简洁，重点突出
- **移动友好**: 使用响应式CSS适配移动设备
- **品牌一致**: 统一的颜色和字体风格
- **变量准确**: 确保变量名称和数据匹配

### 通知规则优化
- **合理频率**: 避免过于频繁的通知
- **分级提醒**: 设置多个时间节点的提醒
- **收件人分组**: 不同重要级别发给不同人员
- **测试验证**: 新规则先小范围测试

### 日常维护
- **定期检查日志**: 及时发现和解决问题
- **清理无效配置**: 删除不再使用的配置和规则
- **备份重要模板**: 备份自定义的重要模板
- **监控发送量**: 避免触发邮件服务商限制

## 🆘 支持与帮助

### 常见问题

**Q: Gmail提示"密码错误"怎么办？**
A: 需要在Gmail设置中开启"两步验证"，然后生成"应用专用密码"使用。

**Q: 邮件模板中的变量没有被替换？**  
A: 检查变量名是否正确，确保使用双花括号`{{variable}}`语法。

**Q: 为什么有些邮件发送失败？**
A: 可能原因包括收件人地址无效、SMTP配置错误、网络问题等，查看日志获取详细错误信息。

**Q: 如何批量导入收件人？**
A: 目前需要逐个添加收件人，建议创建不同的规则分组管理。

### 技术支持

- 📧 **系统日志**: 前端界面可查看详细操作日志
- 🔧 **API接口**: 后端提供完整REST API
- 📱 **多端支持**: 支持桌面和移动端浏览器访问

---

**最后更新**: 2024年12月20日  
**系统版本**: DomainFlow v1.0.0 with Email Notification System

🎉 **享受强大的域名监控邮件通知功能吧！** 